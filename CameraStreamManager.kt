// CameraStreamManager.kt\n\npackage com.example.camerastream\n\nimport android.content.Context\nimport android.hardware.Camera\nimport android.media.MediaRecorder\nimport android.util.Log\nimport java.io.IOException\n\nclass CameraStreamManager(private val context: Context) {\n    private var camera: Camera? = null\n    private var mediaRecorder: MediaRecorder? = null\n    private var isStreaming = false\n\n    fun startStreaming() {\n        if (isStreaming) return\n        try {\n            camera = Camera.open()\n            mediaRecorder = MediaRecorder()\n            camera?.unlock()\n            mediaRecorder?.setCamera(camera)\n            mediaRecorder?.setAudioSource(MediaRecorder.AudioSource.CAMCORDER)\n            mediaRecorder?.setVideoSource(MediaRecorder.VideoSource.CAMERA)\n            mediaRecorder?.setOutputFormat(MediaRecorder.OutputFormat.MPEG_4)\n            mediaRecorder?.setAudioEncoder(MediaRecorder.AudioEncoder.AAC)\n            mediaRecorder?.setVideoEncoder(MediaRecorder.VideoEncoder.H264)\n            mediaRecorder?.setOutputFile("output_stream.mp4")\n            mediaRecorder?.setPreviewDisplay(null) // Set your surface holder here\n            mediaRecorder?.prepare()\n            mediaRecorder?.start()\n            isStreaming = true\n        } catch (e: IOException) {\n            Log.e("CameraStreamManager", "Error starting camera stream: ", e)\n        } finally {\n            // Cleanup resources in case of errors\n            releaseResources()\n        }\n    }\n\n    fun stopStreaming() {\n        if (!isStreaming) return\n        try {\n            mediaRecorder?.stop()\n            mediaRecorder?.reset()\n            isStreaming = false\n        } catch (e: Exception) {\n            Log.e("CameraStreamManager", "Error stopping camera stream: ", e)\n        } finally {\n            releaseResources()\n        }\n    }\n\n    private fun releaseResources() {\n        mediaRecorder?.release()\n        camera?.release()\n        mediaRecorder = null\n        camera = null\n    }\n}